
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>bot - Patrick</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="我们生而破碎，用活着来修修补补,在Windows系统下实现用gocq+nonebot2搭建一个属于自己的qq机器人


介绍
go-cqhttp: 无头客户端,与QQ服务器连接，模拟真实QQ客户端，与自己的后端逻辑框架（即头）进行,"> 
    <meta name="author" content="Patrick"> 
    <link rel="alternative" href="atom.xml" title="Patrick" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Patrick</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://example.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">bot</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">bot</h1>
        <div class="stuff">
            <span>十月 09, 2021</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/bot/" rel="tag">bot</a></li></ul>


        </div>
        <div class="content markdown">
            <p>在Windows系统下实现用gocq+nonebot2搭建一个属于自己的qq机器人</p>
<span id="more"></span>

<h2><span id="介绍">介绍</span></h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.go-cqhttp.org/">go-cqhttp</a>: 无头客户端,与QQ服务器连接，模拟真实QQ客户端，与自己的后端逻辑框架（即头）进行交互，实现各种消息通知的收发.</li>
<li><a target="_blank" rel="noopener" href="https://docs.nonebot.dev/">nonebot2</a>: “头骨”,接受无头客户端发送来的消息，提供封装好的方法供开发者编写处理逻辑，相当于“头骨”，起框架作用</li>
</ul>
<h2><span id="注意">注意</span></h2><p>nonebot是基于python编写的一个框架，后续操作都基于python环境实现(python&gt;=3.7).</p>
<h2><span id="环境配置">环境配置</span></h2><h3><span id="python环境">python环境</span></h3><p>进入<a target="_blank" rel="noopener" href="https://www.python.org/">python官网</a>进行下载(推荐3.7.9)<br><img src="https://img13.360buyimg.com/ddimg/jfs/t1/200278/15/12436/229710/6162b599E70365c53/9d1c4fb832a7a90d.png" alt="1.png"><br>下载完之后打开安装<br><img src="https://img14.360buyimg.com/ddimg/jfs/t1/202616/23/10619/101754/6162b5a6E569e875e/0cba3ea74e8a4d8a.png" alt="3.png"><br>在安装完成后，打开cmd(win旁边搜索框搜索cmd)输入python，如果输出python版本既安装成功。<br><img src="https://img14.360buyimg.com/ddimg/jfs/t1/208952/23/4694/17473/6162b599E6b4147b4/746e3d587b334e2d.png" alt="4.png"></p>
<h3><span id="go-cqhttp">go-cqhttp</span></h3><p><a target="_blank" rel="noopener" href="https://github.com/Mrs4s/go-cqhttp/releases">https://github.com/Mrs4s/go-cqhttp/releases</a><br>这里需要我们自己选择自己系统对应的版本<br>我的系统是win64amd，所以我选择<code>go-cqhttp_windows_amd64.exe</code><br><img src="https://img11.360buyimg.com/ddimg/jfs/t1/118541/11/21115/116325/6162b5a5E0b1cb358/0f3b9ee83512a103.png" alt="2.png"><br>下载完直接打开即可，由于是第一次打开，需要加载配置文件<br><img src="https://img13.360buyimg.com/ddimg/jfs/t1/199827/8/12410/28644/6162b596Edd9c7f67/fe73d923a7d90c9a.png" alt="5.png"><br>然后直接关闭cmd，打开文件config.yml进行编辑<br><img src="https://img10.360buyimg.com/ddimg/jfs/t1/205233/23/10187/110489/6162b599E19aa44b8/1441ebd921ef52d3.png" alt="6.png"><br><img src="https://img14.360buyimg.com/ddimg/jfs/t1/108060/12/18771/99569/6162b599E5e7c343c/ef8d8567d4843e10.png" alt="7.png"><br>一共修改的内容如下(改完记得保存！！！)：</p>
<ul>
<li><code>uid</code>: 改成qq账号</li>
<li><code>password</code>: 改成qq密码</li>
<li><code>ws://your_websocket_universal.server</code>改成<code>ws://127.0.0.1:8765/cqhttp/ws</code></li>
<li><code>ws://your_websocket_universal.server</code>改成<code>ws://127.0.0.1:8765/cqhttp/api</code></li>
<li><code>ws://your_websocket_event.server</code>改成<code>ws://127.0.0.1:8765/cqhttp/event</code><br>这里的8765是端口，主要是没被占用的端口都可以，之后的nonebot需要与之对应。<br>设置完后再次打开<code>go-cqhttp_windows_amd64.exe</code>,然后会提示生成bat程序，然后将<code>go-cqhttp_windows_amd64.exe</code>重命名为<code>go-cqhttp.exe</code>,之后直接打开生成的bat程序，然后会提示扫码登录<br>，直接扫码进行登录就行了。<br>登录成功之后显示如下<br><img src="https://img14.360buyimg.com/ddimg/jfs/t1/211367/28/4589/115377/6162b598E0cb7fb78/8daf594331729d77.png" alt="8.png"><br>这里提示连接到反向服务器失败，这里不用管，这是因为nonebot还未安装。</li>
</ul>
<h3><span id="nonebot2">nonebot2</span></h3><p>在cmd输入<br><code>pip install -i https://pypi.doubanio.com/simple nb-cli</code>(推荐)，<br>或者<code>pip install -i https://pypi.doubanio.com/simple nonebot2</code><br>然后等它安装完即可<br><img src="https://img14.360buyimg.com/ddimg/jfs/t1/208126/12/4617/72437/6162b599E2bd4e154/34b4231976105789.png" alt="9.png"><br>然后随便创建一个目录，cd进该目录，输入命令nb进行机器人初始化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># nb</span><br><span class="line"># Create a New Project</span><br><span class="line"># Project Name: lin</span><br><span class="line"># In a &quot;src&quot; folder</span><br><span class="line"># Load NoneBot Builtin Plugin? (y/N) y</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后就创建好了<br>修改.env文件内容为<br><img src="https://img10.360buyimg.com/ddimg/jfs/t1/199429/18/12225/9731/6162b597Eeda798f9/d68e8bce9c48cdb2.png" alt="11.png"><br>修改.env.prod内容为<br><img src="https://img14.360buyimg.com/ddimg/jfs/t1/210269/9/4484/23476/6162b5a5E91c78bcd/b606ecb5fa535d6f.png" alt="12.png"><br>如果看不见是因为文件隐藏了，设置一下显示隐藏文件即可<br>将bot.py内容修改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import nonebot</span><br><span class="line">from nonebot.adapters.cqhttp.bot import Bot</span><br><span class="line"># from nonebot.adapters.cqhttp.bot import Bot</span><br><span class="line"># Custom your logger</span><br><span class="line"># </span><br><span class="line"># from nonebot.log import logger, default_format</span><br><span class="line"># logger.add(&quot;error.log&quot;,</span><br><span class="line">#            rotation=&quot;00:00&quot;,</span><br><span class="line">#            diagnose=False,</span><br><span class="line">#            level=&quot;ERROR&quot;,</span><br><span class="line">#            format=default_format)</span><br><span class="line"></span><br><span class="line"># You can pass some keyword args config to init function</span><br><span class="line">nonebot.init()</span><br><span class="line">nonebot.get_driver().register_adapter(&quot;cqhttp&quot;, Bot)</span><br><span class="line">app = nonebot.get_asgi()</span><br><span class="line">#nonebot.load_builtin_plugins()</span><br><span class="line">nonebot.load_plugins(&quot;src/plugins&quot;)</span><br><span class="line">driver = nonebot.get_driver()</span><br><span class="line"></span><br><span class="line">nonebot.load_from_toml(&quot;pyproject.toml&quot;)</span><br><span class="line"></span><br><span class="line"># Modify some config / config depends on loaded configs</span><br><span class="line"># </span><br><span class="line"># config = driver.config</span><br><span class="line"># do something...</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    nonebot.logger.warning(&quot;Always use `nb run` to start the bot instead of manually running!&quot;)</span><br><span class="line">    nonebot.run(app=&quot;__mp_main__:app&quot;)</span><br></pre></td></tr></table></figure>

<p>命令行输入python bot.py<code>(命令行要在bot.py目录下) ![10.png](https://img11.360buyimg.com/ddimg/jfs/t1/208493/14/4546/48154/6162b596Eedff35b1/a6b97d7457323097.png) 然后就可以输入</code>/echo hello world`测试一下内置的测试插件能不能<br>如果机器人回复hello world就说明成功了，之后就是相关插件的编写了，这些插件放置在src目录下的plugins文件夹里就行。 </p>
<p>Linux系统下的部署过程基本上差不多，无非是换成了命令行形式，大同小异。</p>
<p>其它具体内容的实现请参考官方文档<br><a target="_blank" rel="noopener" href="https://docs.go-cqhttp.org/">go-cqhttp</a><br><a target="_blank" rel="noopener" href="https://docs.nonebot.dev/">nonebot2</a></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">注意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">3.1.</span> <span class="toc-text">python环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">3.2.</span> <span class="toc-text">go-cqhttp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">3.3.</span> <span class="toc-text">nonebot2</span></a></li></ol></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
